{"ast":null,"code":"import _slicedToArray from\"C:/Users/licos/Desktop/projects/shop_online/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useContext}from'react';import{Container,Col,Row,Card,Button,Spinner}from'react-bootstrap';import CarouselComponent from'../components/Carousel';import star from'../accets/star.jpg';import{useParams}from'react-router-dom';import{observer}from'mobx-react-lite';import{fetchOneProduct,fetchCart,createCart,createCartProducts,fetchTypeById,fetchCartProductsByCartIdAndProductId,fetchCartProductsByCartId}from'../http/productAPI';import{Context}from'../index';import PopUp from'../components/Modals/PopUp';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ProductPage=observer(function(){var _useContext=useContext(Context),product=_useContext.product,user=_useContext.user;var _useState=useState({info:[],images:[]}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),cart=_useState6[0],setCart=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isCart=_useState8[0],setIsCart=_useState8[1];var _useParams=useParams(),id=_useParams.id;var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),popUpVisible=_useState10[0],setPopUpVisible=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),selectedType=_useState12[0],setSelectedType=_useState12[1];useEffect(function(){fetchOneProduct(id).then(function(data){return setState(data);}).finally(function(){setIsLoading(false);if(!state.typeId){}else{fetchTypeById(state.typeId).then(function(data){return setSelectedType(data.name);});}fetchCart(user.user.id).then(function(data){if(!data||data.result==='not found'){}else{setCart(data.id);product.setCart(data.id);fetchCartProductsByCartIdAndProductId(data.id,id).then(function(data){try{if(!data){console.log('here f');setIsCart(false);}else if(data.length===0){setIsCart(false);}else{setIsCart(true);}}catch(error){throw error;}});}});});},[user,state.typeId]);var showPopUp=function showPopUp(){console.log('isCart',isCart);alert(\"Товар добавлен в корзину\");};if(isLoading){return/*#__PURE__*/_jsx(Spinner,{animation:\"grow\"});}var adjImages=state.images.map(function(e){return\"\".concat(e.scr);});var addToCart=function addToCart(){console.log('cart',cart);if(!cart){createCart(user.user.id).then(function(data){setCart(data.id);product.setCart(data.id);createCartProducts(data.id,id,state.price,1).then(function(data){}).finally(function(){setIsCart(true);showPopUp();fetchCartProductsByCartId(data.id).then(function(data){product.setCartProducts(data);});});});}else{createCartProducts(cart,id,state.price,1).then(function(data){}).finally(function(){setIsCart(true);showPopUp();});}fetchCartProductsByCartId(cart).then(function(data){product.setCartProducts(data);});};var count=0;var getCount=function getCount(){count++;return count;};return/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(Row,{className:\"mt-3\",children:[/*#__PURE__*/_jsx(Col,{md:8,children:/*#__PURE__*/_jsx(CarouselComponent,{images:adjImages})}),/*#__PURE__*/_jsxs(Col,{md:4,children:[/*#__PURE__*/_jsxs(Card,{className:\"d-flex flex-column align-items-left justify-content-around border-0\",children:[\" \",/*#__PURE__*/_jsxs(\"h3\",{style:{fontSize:'22px',marginTop:'2px'},children:[state.name,\" \"]}),!selectedType?'':/*#__PURE__*/_jsx(\"p\",{children:\"\\u0420\\u0430\\u0437\\u043C\\u0435\\u0449\\u0435\\u043D\\u043E \\u0432 \\u0440\\u0430\\u0437\\u0434\\u0435\\u043B\\u0435: \".concat(selectedType)}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"h3\",{style:{fontSize:'18px'},children:[\"\\u0426\\u0435\\u043D\\u0430: \",state.price,\" \\u0440\\u0443\\u0431.\"]}),/*#__PURE__*/_jsx(\"hr\",{}),isCart?/*#__PURE__*/_jsx(\"p\",{className:\"mt-3\",variant:\"outline-dark\",style:{boxShadow:'rgba(50, 50, 93, 0.25) 0px 30px 60px -12px inset, rgba(0, 0, 0, 0.3) 0px 18px 36px -18px inset;'},children:\"\\u0422\\u043E\\u0432\\u0430\\u0440 \\u0434\\u043E\\u0431\\u0430\\u0432\\u043B\\u0435\\u043D \\u0432 \\u043A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0443\"}):/*#__PURE__*/_jsx(Button,{className:\"mt-3\",variant:\"outline-dark\",onClick:function onClick(){return addToCart();},children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0432 \\u043A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0443\"})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"mt-5 mb-3\",style:{fontSize:'20px'},children:\"\\u0425\\u0430\\u0440\\u0430\\u043A\\u0442\\u0435\\u0440\\u0438\\u0441\\u0442\\u0438\\u043A\\u0438\"}),state.info.map(function(i,index){return/*#__PURE__*/_jsxs(Row,{className:\"d-flex mt-2\",style:{background:index%2!==0?\"lightgray\":\"transparant\"},children:[/*#__PURE__*/_jsx(Col,{md:3,children:getCount()}),/*#__PURE__*/_jsx(Col,{md:9,children:i.description})]},i.id);})]})]})});});export default ProductPage;","map":{"version":3,"sources":["C:/Users/licos/Desktop/projects/shop_online/client/src/pages/ProductPage.js"],"names":["React","useEffect","useState","useContext","Container","Col","Row","Card","Button","Spinner","CarouselComponent","star","useParams","observer","fetchOneProduct","fetchCart","createCart","createCartProducts","fetchTypeById","fetchCartProductsByCartIdAndProductId","fetchCartProductsByCartId","Context","PopUp","ProductPage","product","user","info","images","state","setState","isLoading","setIsLoading","cart","setCart","isCart","setIsCart","id","popUpVisible","setPopUpVisible","selectedType","setSelectedType","then","data","finally","typeId","name","result","console","log","length","error","showPopUp","alert","adjImages","map","e","scr","addToCart","price","setCartProducts","count","getCount","fontSize","marginTop","boxShadow","i","index","background","description"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from 'react'\r\nimport { Container, Col, Row, Card, Button, Spinner } from 'react-bootstrap';\r\nimport CarouselComponent from '../components/Carousel'\r\nimport star from '../accets/star.jpg'\r\nimport { useParams } from 'react-router-dom'\r\nimport { observer } from 'mobx-react-lite'\r\nimport { fetchOneProduct, fetchCart, createCart, createCartProducts, fetchTypeById, fetchCartProductsByCartIdAndProductId, fetchCartProductsByCartId } from '../http/productAPI'\r\nimport { Context } from '../index'\r\nimport PopUp from '../components/Modals/PopUp'\r\n\r\nconst ProductPage = observer(() => {\r\n  const { product, user } = useContext(Context)\r\n  const [state, setState] = useState({ info: [], images: [] })\r\n  const [isLoading, setIsLoading] = useState(true)\r\n  const [cart, setCart] = useState()\r\n  const [isCart, setIsCart] = useState(false)\r\n  const { id } = useParams()\r\n  const [popUpVisible, setPopUpVisible] = useState(false)\r\n  const [selectedType, setSelectedType] = useState()\r\n\r\n  useEffect(() => {\r\n    fetchOneProduct(id).then(data => setState(data)).finally(() => {\r\n      setIsLoading(false)\r\n      if (!state.typeId) {\r\n\r\n      } else {\r\n        fetchTypeById(state.typeId).then(data => setSelectedType(data.name))\r\n      }\r\n      \r\n      fetchCart(user.user.id).then(data => {\r\n        if (!data || data.result === 'not found') {\r\n\r\n        } else {\r\n          setCart(data.id)\r\n          product.setCart(data.id)\r\n          fetchCartProductsByCartIdAndProductId(data.id, id).then(data => {\r\n            \r\n            try {\r\n              if (!data) {\r\n                console.log('here f')\r\n                setIsCart(false)\r\n              } else if (data.length === 0) {\r\n                setIsCart(false)\r\n              } else {\r\n                setIsCart(true)\r\n              }\r\n            } catch (error) {\r\n              throw error\r\n            }\r\n\r\n          })\r\n        }\r\n      })\r\n    })\r\n\r\n  }, [user, state.typeId])\r\n\r\n  const showPopUp = () => {\r\n    console.log('isCart', isCart)\r\n    alert(\"Товар добавлен в корзину\")\r\n  }\r\n\r\n\r\n\r\n  if (isLoading) {\r\n    return <Spinner animation={\"grow\"} />\r\n  }\r\n\r\n  const adjImages = state.images.map(e => {\r\n    return `${e.scr}`\r\n  })\r\n\r\n  const addToCart = () => {\r\n    console.log('cart', cart)\r\n    if (!cart) {\r\n      createCart(user.user.id).then(data => {\r\n        setCart(data.id)\r\n        product.setCart(data.id)\r\n        createCartProducts(data.id, id, state.price, 1).then(data => {\r\n        }).finally(() => {\r\n          setIsCart(true)\r\n          showPopUp()\r\n          fetchCartProductsByCartId(data.id).then(data => {\r\n            product.setCartProducts(data)\r\n          })\r\n        })\r\n      })\r\n    } else {\r\n      createCartProducts(cart, id, state.price, 1).then(data => {\r\n      }).finally(() => {\r\n        setIsCart(true)\r\n        showPopUp()\r\n      })\r\n    }\r\n    fetchCartProductsByCartId(cart).then(data => {\r\n      product.setCartProducts(data)\r\n    })\r\n\r\n  }\r\n\r\n  let count = 0\r\n  const getCount = () => {\r\n    count++\r\n    return count\r\n  }\r\n\r\n\r\n  return (\r\n    <Container>\r\n      <Row className=\"mt-3\">\r\n        <Col md={8}>\r\n          <CarouselComponent images={adjImages} />\r\n        </Col>\r\n        <Col md={4}>\r\n          <Card\r\n            className=\"d-flex flex-column align-items-left justify-content-around border-0\"\r\n          > <h3 style={{ fontSize: '22px', marginTop: '2px' }}>{state.name} </h3>\r\n            {!selectedType ? '' : <p>{`Размещено в разделе: ${selectedType}`}</p>}\r\n            <hr />\r\n            <h3 style={{ fontSize: '18px' }}>Цена: {state.price} руб.</h3>\r\n            <hr />\r\n            {isCart ?\r\n              <p\r\n                className=\"mt-3\"\r\n                variant={\"outline-dark\"}\r\n                style={{ boxShadow: 'rgba(50, 50, 93, 0.25) 0px 30px 60px -12px inset, rgba(0, 0, 0, 0.3) 0px 18px 36px -18px inset;' }}\r\n              >Товар добавлен в корзину</p>\r\n              :\r\n              <Button\r\n                className=\"mt-3\"\r\n                variant={\"outline-dark\"}\r\n                onClick={() => addToCart()}\r\n              >Добавить в корзину</Button>}\r\n          </Card>\r\n          <h3 className=\"mt-5 mb-3\" style={{ fontSize: '20px' }}>Характеристики</h3>\r\n          {state.info.map((i, index) => {\r\n\r\n            return (<Row\r\n              key={i.id}\r\n              className=\"d-flex mt-2\"\r\n              style={{ background: index % 2 !== 0 ? \"lightgray\" : \"transparant\" }}\r\n            >\r\n              <Col md={3}>\r\n                {getCount()}\r\n              </Col>\r\n              <Col md={9}>\r\n                {i.description}\r\n              </Col>\r\n            </Row>)\r\n          })}\r\n        </Col>\r\n      </Row>\r\n    </Container>\r\n  )\r\n})\r\n\r\nexport default ProductPage;"]},"metadata":{},"sourceType":"module"}