{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/licos/Desktop/projects/shop_online/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/licos/Desktop/projects/shop_online/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/licos/Desktop/projects/shop_online/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useState}from'react';import{Container,Card,Form,Button,Row}from'react-bootstrap';import{NavLink,useHistory,useLocation}from'react-router-dom';import{login,registration}from'../../src/http/userAPI';import{fetchCart,fetchCartProductsByCartId,createCart}from'../../src/http/productAPI';import{REGISTRATION_ROUTE,SHOP_ROUTE}from'../utils/consts';import{LOGIN_ROUTE}from'../utils/consts';import{observer}from'mobx-react-lite';import{Context}from'..';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthPage=observer(function(){var _useContext=useContext(Context),user=_useContext.user,product=_useContext.product;var history=useHistory();var location=useLocation();var isLogin=location.pathname===LOGIN_ROUTE;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var clickHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var currUser;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!isLogin){_context.next=7;break;}_context.next=4;return login(email,password);case 4:currUser=_context.sent;_context.next=10;break;case 7:_context.next=9;return registration(email,password);case 9:currUser=_context.sent;case 10:if(!currUser){}else{user.setUser(currUser);user.setIsAuth(true);fetchCart(currUser.id).then(function(data){if(!data||data.result==='not found'){createCart(currUser.id).then(function(data){product.setCart(data.id);});}else{product.setCart(data.id);}});}history.push(SHOP_ROUTE);_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);throw _context.t0;case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function clickHandler(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Container,{className:\"d-flex justify-content-center align-items-center p-5\",children:/*#__PURE__*/_jsxs(Card,{style:{width:'600px'},className:\"p-5\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"m-auto\",children:[\" \",isLogin?\"Авторизация\":\"Регистрация\"]}),/*#__PURE__*/_jsxs(Form,{className:\"d-flex flex-column\",children:[/*#__PURE__*/_jsx(Form.Control,{className:\"mt-3\",placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 email\",value:email,onChange:function onChange(e){return setEmail(e.target.value);}}),/*#__PURE__*/_jsx(Form.Control,{className:\"mt-3\",placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C\",value:password,type:\"password\",onChange:function onChange(e){return setPassword(e.target.value);}}),/*#__PURE__*/_jsxs(Row,{className:\"d-flex justify-content-between mt-3 pl-3 pr-3\",children:[isLogin?/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u041D\\u0435\\u0442 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442\\u0430? \",/*#__PURE__*/_jsx(NavLink,{to:REGISTRATION_ROUTE,children:\"\\u0417\\u0430\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0438\\u0440\\u0443\\u0439\\u0442\\u0435\\u0441\\u044C\"}),\" \"]}):/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u0415\\u0441\\u0442\\u044C \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442? \",/*#__PURE__*/_jsx(NavLink,{to:LOGIN_ROUTE,children:\"\\u0412\\u043E\\u0439\\u0434\\u0438\\u0442\\u0435\"}),\" \"]}),/*#__PURE__*/_jsx(Button,{variant:\"outline-dark\",onClick:function onClick(){return clickHandler();},children:isLogin?\"Войти\":\"Зарегистрироваться\"})]})]})]})});});export default AuthPage;","map":{"version":3,"sources":["C:/Users/licos/Desktop/projects/shop_online/client/src/pages/Auth.js"],"names":["React","useContext","useState","Container","Card","Form","Button","Row","NavLink","useHistory","useLocation","login","registration","fetchCart","fetchCartProductsByCartId","createCart","REGISTRATION_ROUTE","SHOP_ROUTE","LOGIN_ROUTE","observer","Context","AuthPage","user","product","history","location","isLogin","pathname","email","setEmail","password","setPassword","clickHandler","currUser","setUser","setIsAuth","id","then","data","result","setCart","push","width","e","target","value"],"mappings":"wfAAA,MAAOA,CAAAA,KAAP,EAAgBC,UAAhB,CAA4BC,QAA5B,KAA4C,OAA5C,CACA,OAASC,SAAT,CAAoBC,IAApB,CAA0BC,IAA1B,CAAgCC,MAAhC,CAAwCC,GAAxC,KAAmD,iBAAnD,CACA,OAASC,OAAT,CAAkBC,UAAlB,CAA8BC,WAA9B,KAAiD,kBAAjD,CACA,OAASC,KAAT,CAAgBC,YAAhB,KAAoC,wBAApC,CACA,OAASC,SAAT,CAAoBC,yBAApB,CAA+CC,UAA/C,KAAiE,2BAAjE,CACA,OAASC,kBAAT,CAA6BC,UAA7B,KAA+C,iBAA/C,CACA,OAASC,WAAT,KAA4B,iBAA5B,CACA,OAASC,QAAT,KAAyB,iBAAzB,CACA,OAASC,OAAT,KAAwB,IAAxB,C,wFAEA,GAAMC,CAAAA,QAAQ,CAAGF,QAAQ,CAAC,UAAM,CAE9B,gBAA0BlB,UAAU,CAACmB,OAAD,CAApC,CAAQE,IAAR,aAAQA,IAAR,CAAcC,OAAd,aAAcA,OAAd,CACA,GAAMC,CAAAA,OAAO,CAAGf,UAAU,EAA1B,CACA,GAAMgB,CAAAA,QAAQ,CAAGf,WAAW,EAA5B,CACA,GAAMgB,CAAAA,OAAO,CAAGD,QAAQ,CAACE,QAAT,GAAsBT,WAAtC,CACA,cAA0BhB,QAAQ,CAAC,EAAD,CAAlC,wCAAO0B,KAAP,eAAcC,QAAd,eACA,eAAgC3B,QAAQ,CAAC,EAAD,CAAxC,yCAAO4B,QAAP,eAAiBC,WAAjB,eAEA,GAAMC,CAAAA,YAAY,0FAAG,oKAGbN,OAHa,+CAIEf,CAAAA,KAAK,CAACiB,KAAD,CAAQE,QAAR,CAJP,QAIfG,QAJe,mEAMErB,CAAAA,YAAY,CAACgB,KAAD,CAAQE,QAAR,CANd,QAMfG,QANe,uBAQjB,GAAI,CAACA,QAAL,CAAe,CAEd,CAFD,IAEO,CACLX,IAAI,CAACY,OAAL,CAAaD,QAAb,EACAX,IAAI,CAACa,SAAL,CAAe,IAAf,EAEAtB,SAAS,CAACoB,QAAQ,CAACG,EAAV,CAAT,CAAuBC,IAAvB,CAA4B,SAAAC,IAAI,CAAI,CAClC,GAAI,CAACA,IAAD,EAASA,IAAI,CAACC,MAAL,GAAgB,WAA7B,CAA0C,CACxCxB,UAAU,CAACkB,QAAQ,CAACG,EAAV,CAAV,CAAwBC,IAAxB,CAA6B,SAAAC,IAAI,CAAI,CACnCf,OAAO,CAACiB,OAAR,CAAgBF,IAAI,CAACF,EAArB,EACD,CAFD,EAGD,CAJD,IAIO,CACLb,OAAO,CAACiB,OAAR,CAAgBF,IAAI,CAACF,EAArB,EACD,CACF,CARD,EASD,CACDZ,OAAO,CAACiB,IAAR,CAAaxB,UAAb,EAxBiB,wKAAH,kBAAZe,CAAAA,YAAY,0CAAlB,CA+BA,mBACA,KAAC,SAAD,EAAW,SAAS,CAAC,sDAArB,uBACE,MAAC,IAAD,EAAM,KAAK,CAAE,CAAEU,KAAK,CAAE,OAAT,CAAb,CAAiC,SAAS,CAAC,KAA3C,wBACE,YAAI,SAAS,CAAC,QAAd,eAAyBhB,OAAO,CAAG,aAAH,CAAmB,aAAnD,GADF,cAEE,MAAC,IAAD,EAAM,SAAS,CAAC,oBAAhB,wBACE,KAAC,IAAD,CAAM,OAAN,EACE,SAAS,CAAC,MADZ,CAEE,WAAW,CAAC,kDAFd,CAGE,KAAK,CAAEE,KAHT,CAIE,QAAQ,CAAE,kBAACe,CAAD,QAAOd,CAAAA,QAAQ,CAACc,CAAC,CAACC,MAAF,CAASC,KAAV,CAAf,EAJZ,EADF,cAOE,KAAC,IAAD,CAAM,OAAN,EACE,SAAS,CAAC,MADZ,CAEE,WAAW,CAAC,iFAFd,CAGE,KAAK,CAAEf,QAHT,CAIE,IAAI,CAAC,UAJP,CAKE,QAAQ,CAAE,kBAACa,CAAD,QAAOZ,CAAAA,WAAW,CAACY,CAAC,CAACC,MAAF,CAASC,KAAV,CAAlB,EALZ,EAPF,cAcE,MAAC,GAAD,EAAK,SAAS,CAAC,+CAAf,WACGnB,OAAO,cAAG,4GAAmB,KAAC,OAAD,EAAS,EAAE,CAAEV,kBAAb,oHAAnB,OAAH,cACJ,4GAAmB,KAAC,OAAD,EAAS,EAAE,CAAEE,WAAb,wDAAnB,OAFN,cAIE,KAAC,MAAD,EACE,OAAO,CAAE,cADX,CAEE,OAAO,CAAE,yBAAMc,CAAAA,YAAY,EAAlB,EAFX,UAIGN,OAAO,CAAG,OAAH,CAAa,oBAJvB,EAJF,GAdF,GAFF,GADF,EADA,CAiCD,CAzEwB,CAAzB,CA2EA,cAAeL,CAAAA,QAAf","sourcesContent":["import React, { useContext, useState } from 'react'\r\nimport { Container, Card, Form, Button, Row } from 'react-bootstrap'\r\nimport { NavLink, useHistory, useLocation } from 'react-router-dom'\r\nimport { login, registration } from '../../src/http/userAPI'\r\nimport { fetchCart, fetchCartProductsByCartId, createCart } from '../../src/http/productAPI'\r\nimport { REGISTRATION_ROUTE, SHOP_ROUTE } from '../utils/consts'\r\nimport { LOGIN_ROUTE } from '../utils/consts'\r\nimport { observer } from 'mobx-react-lite'\r\nimport { Context } from '..'\r\n\r\nconst AuthPage = observer(() => {\r\n\r\n  const { user, product } = useContext(Context)\r\n  const history = useHistory()\r\n  const location = useLocation()\r\n  const isLogin = location.pathname === LOGIN_ROUTE\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n\r\n  const clickHandler = async () => {\r\n    try {\r\n      let currUser\r\n      if (isLogin) {\r\n        currUser = await login(email, password)\r\n      } else {\r\n        currUser = await registration(email, password)\r\n      }\r\n      if (!currUser) {\r\n\r\n      } else {\r\n        user.setUser(currUser)\r\n        user.setIsAuth(true)\r\n\r\n        fetchCart(currUser.id).then(data => {\r\n          if (!data || data.result === 'not found') {\r\n            createCart(currUser.id).then(data => {\r\n              product.setCart(data.id)\r\n            })\r\n          } else {\r\n            product.setCart(data.id)\r\n          }\r\n        })\r\n      }\r\n      history.push(SHOP_ROUTE)\r\n    } catch (e) {\r\n    throw e\r\n  }\r\n\r\n}\r\n\r\n  return (\r\n  <Container className=\"d-flex justify-content-center align-items-center p-5\">\r\n    <Card style={{ width: '600px' }} className=\"p-5\">\r\n      <h2 className=\"m-auto\"> {isLogin ? \"Авторизация\" : \"Регистрация\"}</h2>\r\n      <Form className=\"d-flex flex-column\">\r\n        <Form.Control\r\n          className=\"mt-3\"\r\n          placeholder=\"Введите email\"\r\n          value={email}\r\n          onChange={(e) => setEmail(e.target.value)}\r\n        />\r\n        <Form.Control\r\n          className=\"mt-3\"\r\n          placeholder=\"Введите пароль\"\r\n          value={password}\r\n          type=\"password\"\r\n          onChange={(e) => setPassword(e.target.value)}\r\n        />\r\n        <Row className=\"d-flex justify-content-between mt-3 pl-3 pr-3\">\r\n          {isLogin ? <div>Нет аккаунта? <NavLink to={REGISTRATION_ROUTE}>Зарегистрируйтесь</NavLink> </div>\r\n            : <div>Есть аккаунт? <NavLink to={LOGIN_ROUTE}>Войдите</NavLink> </div>\r\n          }\r\n          <Button\r\n            variant={\"outline-dark\"}\r\n            onClick={() => clickHandler()}\r\n          >\r\n            {isLogin ? \"Войти\" : \"Зарегистрироваться\"}\r\n          </Button>\r\n        </Row>\r\n      </Form>\r\n    </Card>\r\n  </Container>\r\n)\r\n})\r\n\r\nexport default AuthPage;"]},"metadata":{},"sourceType":"module"}